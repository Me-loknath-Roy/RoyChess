<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RoyChess — Online Chess Game</title>

  <!-- Chessboard.js CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css"/>

  <style>
    :root{
      --bg: linear-gradient(135deg,#0f172a 0%, #001219 100%);
      --card: rgba(255,255,255,0.06);
      --accent: linear-gradient(90deg,#8b5cf6,#06b6d4);
      --glass: rgba(255,255,255,0.04);
      --muted: rgba(255,255,255,0.6);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,ui-sans-serif,system-ui;
      background:var(--bg);
      color:#e6eef8;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:32px
    }
    .wrap{
      width:100%;
      max-width:1100px;
      display:grid;
      grid-template-columns:520px 1fr;
      gap:28px
    }

    .card{
      background:rgba(255,255,255,0.03);
      border-radius:14px;
      padding:18px;
      box-shadow:0 6px 30px rgba(2,6,23,0.7);
      backdrop-filter: blur(6px);
      border:1px solid rgba(255,255,255,0.04)
    }

    .left{display:flex;flex-direction:column;align-items:center;padding:18px}
    #board{width:100%;max-width:480px}

    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    button.btn{
      padding:8px 12px;
      border-radius:10px;
      border:0;
      background:var(--glass);
      color:var(--muted);
      cursor:pointer;
      font-weight:600
    }
    button.btn.primary{
      background:var(--accent);
      color:white;
      padding:10px 14px
    }
    .status{margin-top:12px;text-align:center;color:var(--muted);font-size:14px}

    h1{
      font-size:22px;
      margin:0;
      background:linear-gradient(90deg,#fff,#bde0fe);
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent
    }
    .moves{
      background:rgba(255,255,255,0.02);
      padding:12px;
      border-radius:10px;
      min-height:150px;
      overflow:auto
    }
    .moves ol{margin:0;padding-left:20px;color:var(--muted)}

    @media (max-width:900px){
      .wrap{grid-template-columns:1fr;}
    }

    .square-55d63{transition: background 120ms ease}
    .black-3c85d{background: linear-gradient(180deg,#708090,#465a66)}
    .white-1e1d7{background: linear-gradient(180deg,#f8fafc,#e6eef8)}
    .highlight { box-shadow: inset 0 0 0 4px rgba(99,102,241,0.15); }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card left">
      <div id="board" style="width:480px"></div>

      <div class="controls">
        <button class="btn primary" id="btnNew">New Game</button>
        <button class="btn" id="btnUndo">Undo</button>
        <button class="btn" id="btnFlip">Flip Board</button>
        <button class="btn" id="btnExport">Export FEN</button>
        <button class="btn" id="btnTheme">Toggle Theme</button>
      </div>

      <div class="status" id="status">Play: White — Drag a piece to move</div>
    </div>

    <div class="card">
      <h1>RoyChess</h1>
      <p style="color:#9ca3af;">A fully interactive online chess game with drag & drop, move validation, checkmate detection, move history, and theme toggling.</p>

      <div class="moves">
        <strong style="color:white">Move History</strong>
        <ol id="movesList"></ol>
      </div>
    </div>
  </div>

  <!-- JAVASCRIPT LIBRARIES -->
  <script src="https://cdn.jsdelivr.net/npm/chess.js@1.0.0/chess.min.js"></script>

  <!-- REQUIRED: jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Chessboard.js -->
  <script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>


  <script>
    const game = new Chess();

    const board = Chessboard('board', {
      draggable: true,
      position: 'start',
      onDragStart: onDragStart,
      onDrop: onDrop,
      onSnapEnd: onSnapEnd,
      onMouseoverSquare: onMouseoverSquare,
      onMouseoutSquare: onMouseoutSquare
    });

    const statusEl = document.getElementById('status');
    const movesList = document.getElementById('movesList');

    function onDragStart(source, piece) {
      if (game.game_over()) return false;
      if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
          (game.turn() === 'b' && piece.search(/^w/) !== -1)) return false;
    }

    function onDrop(source, target) {
      let move = game.move({
        from: source,
        to: target,
        promotion: 'q'
      });

      if (move === null) return 'snapback';
      updateStatus();
    }

    function onSnapEnd() {
      board.position(game.fen());
    }

    function updateStatus() {
      const turn = game.turn() === 'w' ? 'White' : 'Black';
      let status = `Play: ${turn}`;

      if (game.in_checkmate()) {
        status = `Checkmate — ${turn === 'White' ? 'Black' : 'White'} wins.`;
      } else if (game.in_draw()) {
        status = "Draw — game over";
      } else if (game.in_check()) {
        status += " — Check!";
      }

      statusEl.textContent = status;

      const hist = game.history();
      movesList.innerHTML = "";
      hist.forEach((m, i) => {
        const li = document.createElement("li");
        li.textContent = m;
        movesList.appendChild(li);
      });
    }

    function onMouseoverSquare(square) {
      const moves = game.moves({ square, verbose: true });
      if (!moves.length) return;

      moves.forEach(m => {
        $(`.square-${m.to}`).addClass('highlight');
      });
    }

    function onMouseoutSquare() {
      $('.square-55d63').removeClass('highlight');
    }

    // Buttons
    document.getElementById("btnNew").onclick = () => {
      game.reset();
      board.start();
      updateStatus();
    };

    document.getElementById("btnUndo").onclick = () => {
      game.undo();
      board.position(game.fen());
      updateStatus();
    };

    document.getElementById("btnFlip").onclick = () => board.flip();

    document.getElementById("btnExport").onclick = () => {
      navigator.clipboard.writeText(game.fen())
        .then(() => alert("FEN copied!"))
        .catch(() => alert("Could not copy FEN."));
    };

    let dark = true;
    document.getElementById("btnTheme").onclick = () => {
      dark = !dark;
      document.body.style.background = dark
        ? "linear-gradient(135deg,#0f172a,#001219)"
        : "linear-gradient(135deg,#f8fafc,#dbeafe)";
    };

    updateStatus();
  </script>

</body>
</html>
